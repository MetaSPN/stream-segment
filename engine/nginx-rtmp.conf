# segment-stream â€” nginx RTMP relay template
# Install: apt install nginx libnginx-mod-rtmp (Ubuntu) or brew install nginx-full --with-rtmp-module (macOS)
# Include this in your nginx.conf or merge with update-rtmp-destinations.

worker_processes auto;
events { worker_connections 1024; }

rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;
            record off;

            allow publish 127.0.0.1;
            deny publish all;

            # Add push lines via: update-rtmp-destinations --add YouTube YOUR_KEY
            # push rtmp://a.rtmp.youtube.com/live2/YOUR_KEY;
            # push rtmp://live.twitch.tv/app/YOUR_KEY;

            hls on;
            hls_path /tmp/segment-stream-hls;
            hls_fragment 3;
            hls_playlist_length 60;
        }
    }
}

http {
    server {
        listen 8080;
        location /hls {
            types { application/vnd.apple.mpegurl m3u8; video/mp2t ts; }
            root /tmp;
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
        }
        location /health { return 200 'ok'; add_header Content-Type text/plain; }
    }
}
